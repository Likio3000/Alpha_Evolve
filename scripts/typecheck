#!/usr/bin/env bash
# Lightweight wrapper around mypy.
set -euo pipefail

if command -v uv >/dev/null 2>&1; then
  here=$(cd "$(dirname "$0")" && pwd -P)
  root="$here/.."
  export UV_CACHE_DIR="${UV_CACHE_DIR:-$root/.uv_cache}"
  if uv run mypy "$@"; then
    exit 0
  else
    echo "uv run failed; falling back to python -m mypy" >&2
  fi
fi

if [ -x ".venv/bin/python" ]; then
  PYTHON_BIN=".venv/bin/python"
elif command -v python >/dev/null 2>&1; then
  PYTHON_BIN=python
elif command -v python3 >/dev/null 2>&1; then
  PYTHON_BIN=python3
else
  echo "python interpreter not found" >&2
  exit 1
fi

if [ "$#" -eq 0 ]; then
  set -- src/alpha_evolve/dashboard/api tests/test_dashboard_routes.py
fi

"$PYTHON_BIN" -m mypy "$@"
